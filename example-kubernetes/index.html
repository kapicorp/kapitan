



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Kubernetes - Kapitan documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#kubernetes-example" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Kapitan documentation" aria-label="Kapitan documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Kapitan documentation
            </span>
            <span class="md-header-nav__topic">
              
                Kubernetes
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/deepmind/kapitan/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    deepmind/kapitan
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Kapitan documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Kapitan documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/deepmind/kapitan/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    deepmind/kapitan
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../kapitan_overview/" title="Kapitan Overview" class="md-nav__link">
      Kapitan Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../inventory/" title="Inventory" class="md-nav__link">
      Inventory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../compile/" title="Compiling components/templates" class="md-nav__link">
      Compiling components/templates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Kapitan features
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Kapitan features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../secrets/" title="Secret management" class="md-nav__link">
      Secret management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../validate/" title="Manifest validation" class="md-nav__link">
      Manifest validation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../external_dependencies/" title="External dependency management" class="md-nav__link">
      External dependency management
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Miscellaneous
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Miscellaneous
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CI/" title="Continuous Integration" class="md-nav__link">
      Continuous Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pyenv-scl/" title="Set up kapitan on older Python systems" class="md-nav__link">
      Set up kapitan on older Python systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../usage/" title="Usage" class="md-nav__link">
      Usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proposals/" title="Proposals" class="md-nav__link">
      Proposals
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kubernetes
      </label>
    
    <a href="./" title="Kubernetes" class="md-nav__link md-nav__link--active">
      Kubernetes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    Directory structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory" class="md-nav__link">
    inventory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templates-docs-scripts" class="md-nav__link">
    templates, docs, scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    secrets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../example-terraform/" title="Terraform" class="md-nav__link">
      Terraform
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    Directory structure
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inventory" class="md-nav__link">
    inventory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#templates-docs-scripts" class="md-nav__link">
    templates, docs, scripts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secrets" class="md-nav__link">
    secrets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/deepmind/kapitan/edit/master/docs/example-kubernetes.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="kubernetes-example">Kubernetes example</h1>
<p>Here, we walk through how kapitan could be used to help create kubernetes manifests, whose values are customized for each target according to the inventory structure. The example folder can be found in our repository on Github at <a href="https://github.com/deepmind/kapitan/tree/master/examples/kubernetes">https://github.com/deepmind/kapitan/tree/master/examples/kubernetes</a>.</p>
<h2 id="directory-structure">Directory structure</h2>
<p>The following tree shows what this directory looks like (only showing tree level 1):</p>
<div class="highlight"><pre><span></span><code>├── components
├── docs
├── inventory
├── lib
├── scripts
├── refs
└── templates
</code></pre></div>

<p>We will describe the role of each folder in the following sections.</p>
<h3 id="inventory">inventory</h3>
<p>This folder contains the inventory values used to render the templates for each target. The structure of this folder is as follows:</p>
<div class="highlight"><pre><span></span><code>.
├── classes
│   ├── cluster
│   │   ├── common.yml
│   │   └── minikube.yml
│   ├── common.yml
│   └── component
│       ├── elasticsearch.yml
│       ├── mysql.yml
│       ├── namespace.yml
│       └── nginx.yml
└── targets
    ├── minikube-es.yml
    ├── minikube-mysql.yml
    └── minikube-nginx.yml
</code></pre></div>

<p>The required sub-folder is <code>targets</code>: during compile, kapitan searches for the yaml files under <code>targets</code> in order to identify the targets. In this example, there are three targets:</p>
<ul>
<li>minikube-es</li>
<li>minikube-mysql</li>
<li>minikube-nginx</li>
</ul>
<p>Therefore, when you run <code>kapitan compile</code>, under the <code>compiled</code> folder that kapitan generates, you will see three folders named after these targets.</p>
<p><code>classes</code> is a folder that contains yaml files used as the "base class" in the hierarchical inventory database. The values defined here are inherited by the target files. For more explanation on how this works, look at the <a href="../inventory/">inventory documentation</a>. Notice how the classes are nicely divided up into components and clusters, such as nginx and mysql, in order to clearly define what components each target should contain and to make the classes reusable.</p>
<p>For example, take a look at <code>targets/nginx.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">classes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">common</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">cluster.minikube</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">component.namespace</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">component.nginx</span>

<span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">target_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube-nginx</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${target_name}</span>
</code></pre></div>

<p>This target inherits values from four files under <code>classes</code> folder:</p>
<ul>
<li>common.yml</li>
<li>cluster/minikube.yml</li>
<li>component/namespace.yml</li>
<li>component/nginx.yml</li>
</ul>
<p><em>Note: that some of these classes themselves may inherit from other classes.</em></p>
<p>And the way classes are defined makes it easy to identify what components and clusters this target should contain and belong to!</p>
<p>Let's take a close look now at <code>component/namespace.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${target_name}</span>
  <span class="nt">kapitan</span><span class="p">:</span>
    <span class="nt">compile</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">output_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pre-deploy</span>
      <span class="nt">input_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jsonnet</span>
      <span class="nt">output_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml</span>
      <span class="nt">input_paths</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">components/namespace/main.jsonnet</span>
</code></pre></div>

<p>As we see, this file declares a <code>kapitan.compile</code> item whose input path (i.e. the template file) is <code>components/namespace/main.jsonnet</code> which, when rendered, will generate yaml file(s) under <code>compiled/minikube-nginx/pre-deploy</code>.</p>
<p>Don't confuse the <code>components</code> folder with <code>inventory/classes/components</code> folder: the former contains the actual templates, while the latter contains inventory classes.</p>
<h3 id="components">components</h3>
<p>This folder contains the template files as discussed above, typically jsonnet and kadet files. The tree of this directory looks as follows:</p>
<div class="highlight"><pre><span></span><code>.
├── elasticsearch
│   ├── elasticsearch.container.jsonnet
│   ├── elasticsearch.statefulset.jsonnet
│   └── main.jsonnet
├── mysql
│   ├── main.jsonnet
│   ├── secret.jsonnet
│   ├── service.jsonnet
│   └── statefulset.jsonnet
├── namespace
│   └── main.jsonnet
└── nginx
    └── __init__.py
</code></pre></div>

<p>Notice how the directory structure corresponds to that of <code>inventory/classes/components</code> in order to make it easy to identify which templates are used for which components.</p>
<p>As mentioned above, we know that the target <strong>minikube-nginx</strong> inherits from <code>component.namespace</code>. Let's take a look at <code>components/namespace/main.jsonnet</code>:</p>
<div class="highlight"><pre><span></span><code>local kube = import &quot;lib/kube.libjsonnet&quot;;
local kap = import &quot;lib/kapitan.libjsonnet&quot;;
local inventory = kap.inventory();
local p = inventory.parameters;

{
    &quot;00_namespace&quot;: kube.Namespace(p.namespace),
    &quot;10_serviceaccount&quot;: kube.ServiceAccount(&quot;default&quot;)
}
</code></pre></div>

<p>The first two lines import libjsonnet files under <code>lib</code> folder: this is the folder that contains helper files used inside templates. For example, <code>kapitan.libjsonnet</code> allows you to access inventory values inside jsonnet templates, and <code>kube.libjsonnet</code> defines functions to generate popular kubernetes manifests.</p>
<p>The actual object defined in <code>components/namespace/main.jsonnet</code> looks like this:</p>
<div class="highlight"><pre><span></span><code>{
    &quot;00_namespace&quot;: kube.Namespace(p.namespace),
    &quot;10_serviceaccount&quot;: kube.ServiceAccount(&quot;default&quot;)
}
</code></pre></div>

<p>We have "00_namespace" and "10_serviceaccount" as the keys. These will become files under <code>compiled/minikube-nginx/pre-deploy</code>, since <code>pre-deploy</code> is the <code>input_paths</code> declared in the inventory. For instance, <code>00_namespace.yml</code> would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">annotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube-nginx</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube-nginx</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube-nginx</span>
<span class="nt">spec</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</code></pre></div>

<h3 id="templates-docs-scripts">templates, docs, scripts</h3>
<p>These folders contain jinja2 template files. For example, <code>component.elasticsearch</code> contains:</p>
<div class="highlight"><pre><span></span><code><span class="nt">kapitan</span><span class="p">:</span>
  <span class="nt">compile</span><span class="p">:</span>
  <span class="c1"># other items abbreviated for clarity</span>
  <span class="p p-Indicator">-</span> <span class="nt">output_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">scripts</span>
    <span class="nt">input_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jinja2</span>
    <span class="nt">input_paths</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">scripts</span>
  <span class="p p-Indicator">-</span> <span class="nt">output_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
    <span class="nt">input_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jinja2</span>
    <span class="nt">input_paths</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docs/elasticsearch/README.md</span>
</code></pre></div>

<p>Since <code>component.elasticsearch</code> is inherited by the target <strong>minikube-es</strong>, this generates files under <code>compiled/minikube-es/scripts</code> and <code>compiled/minikube-es/README.md</code>.</p>
<h3 id="secrets">secrets</h3>
<p>This folder contains secrets created manually by the user, or automatically by kapitan. Refer to <a href="../secrets/">secrets management</a> for how it works.</p>
<p>In this example, the configuration, such as the recipients, is declared in <code>inventory/classes/common.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">parameters</span><span class="p">:</span>
  <span class="nt">kapitan</span><span class="p">:</span>
    <span class="nt">vars</span><span class="p">:</span>
      <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${target_name}</span>
      <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${target_name}</span>
    <span class="nt">secrets</span><span class="p">:</span>
      <span class="nt">gpg</span><span class="p">:</span>
        <span class="nt">recipients</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example@kapitan.dev</span>
            <span class="nt">fingerprint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">D9234C61F58BEB3ED8552A57E28DC07A3CBFAE7C</span>
</code></pre></div>

<p>The references to the secrets are declared in <code>inventory/classes/component/mysql</code>, which is inherited by the target <strong>minikube-mysql</strong>. After running <code>kapitan compile</code>, some of the generated manifests contain the references to secrets. For example, have a look at <code>compiled/minikube-mysql/manifests/mysql_secret.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">?{gpg:targets/minikube-mysql/mysql/password:ec3d54de}</span>
  <span class="nt">MYSQL_ROOT_PASSWORD_SHA256</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">?{gpg:targets/minikube-mysql/mysql/password_sha256:122d2732}</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">annotations</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example-mysql</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example-mysql</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">minikube-mysql</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
</code></pre></div>

<p><code>MYSQL_ROOT_PASSWORD</code> refers to the secret stored in <code>refs/targets/minikube-mysql/mysql/password</code> and so on.</p>
<p>You may reveal the secrets by running <code>kapitan refs --reveal -f mysql_secret.yml</code> and use the manifest by piping the output to kubectl!</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../proposals/" title="Proposals" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Proposals
              </span>
            </div>
          </a>
        
        
          <a href="../example-terraform/" title="Terraform" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Terraform
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:".."}})</script>
      
    
  </body>
</html>